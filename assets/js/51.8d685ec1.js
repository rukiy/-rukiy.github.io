(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{526:function(n,a,s){"use strict";s.r(a);var t=s(65),e=Object(t.a)({},(function(){var n=this,a=n.$createElement,s=n._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("p",[n._v("使用docker部署v2ray和nginx,并配置ws协议,开启tls")]),n._v(" "),s("h2",{attrs:{id:"说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[n._v("#")]),n._v(" 说明")]),n._v(" "),s("h3",{attrs:{id:"必要条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#必要条件"}},[n._v("#")]),n._v(" 必要条件")]),n._v(" "),s("ol",[s("li",[n._v("docker")]),n._v(" "),s("li",[n._v("域名一枚")]),n._v(" "),s("li",[n._v("证书(证书.crt,证书.key)")])]),n._v(" "),s("h3",{attrs:{id:"创建目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建目录"}},[n._v("#")]),n._v(" 创建目录")]),n._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[n._v("mkdir")]),n._v(" -p /home/v2ray\n"),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("mkdir")]),n._v(" -p /home/nginx/html\n"),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("mkdir")]),n._v(" -p /home/nginx/conf\n")])])]),s("h3",{attrs:{id:"v2ray配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#v2ray配置"}},[n._v("#")]),n._v(" v2ray配置")]),n._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[n._v("tee")]),n._v(" /home/v2ray/config.json "),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("<<-")]),s("span",{pre:!0,attrs:{class:"token string"}},[n._v('\'EOF\'\n{\n    "log": {\n        "access": "/var/log/v2ray/access.log",\n        "error": "/var/log/v2ray/error.log",\n        "loglevel": "warning"\n    },\n    "inbounds": [\n        {\n            "port": 20872,\n            "protocol": "vmess",\n            "settings": {\n                "clients": [\n                    {\n                        "id": "5d94d1bc-749b-7915-2ae8-5d30c8b6cd09",\n                        "level": 1,\n                        "alterId": 64\n                    }\n                ]\n            },\n            "streamSettings": {\n                "network": "ws",\n                "wsSettings": {\n                    "path": "/v2ray"\n                }\n            }\n        }\n    ],\n    "outbounds": [\n        {\n            "protocol": "freedom",\n            "settings": {}\n        }\n    ]\n}\nEOF')]),n._v("\n")])])]),s("h3",{attrs:{id:"nginx配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置"}},[n._v("#")]),n._v(" nginx配置")]),n._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[n._v("tee")]),n._v(" /home/nginx/conf/default.conf "),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("<<-")]),s("span",{pre:!0,attrs:{class:"token string"}},[n._v('\'EOF\'\nserver {\n\n    listen       80;\n    listen  [::]:80;\n    \n    listen 443 ssl http2 default_server;\n    server_name {域名};\n    root /usr/share/nginx/html;\n    \n    ssl_certificate "/etc/nginx/conf.d/{证书}.crt";\n    ssl_certificate_key "/etc/nginx/conf.d/{证书}.key";\n    ssl_session_cache shared:SSL:1m;\n    ssl_session_timeout 10m;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers on;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n    \n    location /koc {\n      proxy_redirect off;\n      proxy_pass http://v2ray:20872/v2ray;\n      proxy_http_version 1.1;\n      proxy_set_header Upgrade $http_upgrade;\n      proxy_set_header Connection "upgrade";\n      proxy_set_header Host $http_host;\n    }\n}\nEOF')]),n._v("\n")])])]),s("h3",{attrs:{id:"启动v2ray"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动v2ray"}},[n._v("#")]),n._v(" 启动v2ray")]),n._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[n._v("docker run -d --name v2ray -v /home/v2ray:/etc/v2ray -v /etc/localtime:/etc/localtime:ro v2ray/official v2ray -config"),s("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v("/etc/v2ray/config.json\n")])])]),s("h3",{attrs:{id:"启动nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动nginx"}},[n._v("#")]),n._v(" 启动nginx")]),n._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[n._v("docker run --name nginx --link v2ray -p "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("80")]),n._v(":80 -p "),s("span",{pre:!0,attrs:{class:"token number"}},[n._v("443")]),n._v(":443 -v /etc/localtime:/etc/localtime:ro -v /home/nginx/html:/usr/share/nginx/html:ro -v /home/nginx/conf/default.conf:/etc/nginx/conf.d/default.conf:ro -d nginx\n")])])]),s("h3",{attrs:{id:"额外工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#额外工作"}},[n._v("#")]),n._v(" 额外工作")]),n._v(" "),s("ol",[s("li",[n._v("开放端口 "),s("code",[n._v("80")]),n._v(" 和"),s("code",[n._v("443")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);